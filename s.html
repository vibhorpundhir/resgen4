<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Recipe Generator</title>
    <!-- Load Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            /* New: Photographic background image */
            background-image: url('https://source.unsplash.com/1920x1080/?food,kitchen,blur,ingredients'); /* A dynamic, high-res food background */
            background-size: cover; /* Ensures the image covers the entire body */
            background-position: center; /* Centers the image */
            background-attachment: fixed; /* Keeps the background image fixed while content scrolls */
        }
        /* Custom vibrant spinner (now purple) */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-left-color: #8b5cf6; /* Purple-500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        /* Custom scrollbar for recipe results */
        #resultsContainer {
            scrollbar-width: thin;
            scrollbar-color: #a78bfa #e5e7eb;
        }
        #resultsContainer::-webkit-scrollbar {
            width: 8px;
        }
        #resultsContainer::-webkit-scrollbar-track {
            background: #e5e7eb;
            border-radius: 10px;
        }
        #resultsContainer::-webkit-scrollbar-thumb {
            background-color: #a78bfa;
            border-radius: 10px;
            border: 2px solid #e5e7eb;
        }
        /* Highlight focus styles for new inset fields */
        .focus-ring-purple:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.5), inset 0 2px 4px 0 rgba(0,0,0,0.05);
            border-color: #a78bfa;
        }
    </style>
</head>
<body class="h-screen overflow-hidden antialiased">

    <!-- Main Dashboard Layout --><div class="container mx-auto max-w-7xl h-full p-4 md:p-6 lg:p-8">
        <div class="flex h-full gap-6">

            <!-- Left Sidebar: Controls --><!-- New: Glassmorphism effect: bg-white/30, backdrop-blur-xl, border, shadow-lg --><aside class="w-full md:w-1/3 lg:w-1/4 h-full flex flex-col bg-white/30 backdrop-blur-xl border border-white/20 rounded-2xl shadow-lg p-6 md:p-8">
                <!-- Header --><header class="mb-8">
                    <h1 class="text-4xl font-extrabold text-indigo-900 leading-tight">
                        AI Recipe Creator <span class="text-purple-700">Pro</span>
                    </h1>
                    <p class="text-gray-800 mt-2 text-lg">Your culinary journey starts here!</p>
                </header>

                <h2 class="text-2xl font-bold text-gray-800 mb-6">Controls Dashboard</h2>

                <!-- Controls Dashboard --><div class="flex-grow space-y-5">
                    
                    <!-- Meal Type: New Layout --><div class="flex items-center gap-3">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center shadow">
                            <svg class="w-5 h-5 text-purple-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 17.812a9.714 9.714 0 01-5.171-1.717M1.25 17.812a9.714 9.714 0 015.171-1.717m14.258 0A9.714 9.714 0 0012 15.082a9.714 9.714 0 00-9.179 1.012M12 15.082V18M12 15.082a9.711 9.711 0 01-3.171-.792m3.171.792a9.711 9.711 0 003.171-.792M12 15.082a9.711 9.711 0 01-3.171-.792M1.25 17.812A9.714 9.714 0 017.42 16.095M16.58 16.095a9.714 9.714 0 016.17 1.717m-14.258 0a9.714 9.714 0 015.171-1.717m9.087 0a9.714 9.714 0 00-5.171-1.717M12 6a3 3 0 100-6 3 3 0 000 6z" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <label for="mealType" class="block text-sm font-semibold text-gray-700 mb-1">Meal Type</label>
                            <!-- New: Inset style: shadow-inner, bg-white/50, border-0 --><select id="mealType" class="w-full p-3 border-0 rounded-lg bg-white/50 shadow-inner focus-ring-purple transition duration-200 appearance-none">
                                <option>Breakfast</option>
                                <option>Lunch</option>
                                <option selected>Dinner</option>
                                <option>Snack</option>
                                <option>Dessert</option>
                            </select>
                        </div>
                    </div>

                    <!-- Key Ingredients: New Layout --><div class="flex items-center gap-3">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center shadow">
                            <svg class="w-5 h-5 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                            </svg>
                        </div>
                         <div class="flex-grow">
                            <label for="ingredients" class="block text-sm font-semibold text-gray-700 mb-1">Key Ingredients</label>
                            <!-- New: Inset style: shadow-inner, bg-white/50, border-0 --><input type="text" id="ingredients" placeholder="e.g., chicken, rice" class="w-full p-3 border-0 rounded-lg bg-white/50 shadow-inner focus-ring-purple transition duration-200">
                        </div>
                    </div>

                    <!-- Dietary Restrictions: New Layout --><div class="flex items-center gap-3">
                         <div class="flex-shrink-0 w-10 h-10 rounded-full bg-green-100 flex items-center justify-center shadow">
                            <svg class="w-5 h-5 text-green-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <label for="diet" class="block text-sm font-semibold text-gray-700 mb-1">Dietary</label>
                            <!-- New: Inset style: shadow-inner, bg-white/50, border-0 --><select id="diet" class="w-full p-3 border-0 rounded-lg bg-white/50 shadow-inner focus-ring-purple transition duration-200 appearance-none">
                                <option>None</option>
                                <option>Vegetarian</option>
                                <option>Vegan</option>
                                <option>Gluten-Free</option>
                                <option>Keto</option>
                                <option>Dairy-Free</option>
                            </select>
                        </div>
                    </div>

                    <!-- Complexity: New Layout --><div class="flex items-center gap-3">
                        <div class="flex-shrink-0 w-10 h-10 rounded-full bg-cyan-100 flex items-center justify-center shadow">
                            <svg class="w-5 h-5 text-cyan-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.31h5.364c.518 0 .734.654.372 1.01l-4.34 3.152a.563.563 0 00-.182.658l1.681 4.902a.563.563 0 01-.814.622l-4.34-3.152a.563.563 0 00-.658 0l-4.34 3.152a.563.563 0 01-.814-.622l1.68-4.902a.563.563 0 00-.182-.658l-4.34-3.152a.563.563 0 01.372-1.01h5.364a.563.563 0 00.475-.31l2.125-5.111z" />
                            </svg>
                        </div>
                        <div class="flex-grow">
                            <label for="complexity" class="block text-sm font-semibold text-gray-700 mb-1">Complexity</label>
                            <!-- New: Inset style: shadow-inner, bg-white/50, border-0 --><select id="complexity" class="w-full p-3 border-0 rounded-lg bg-white/50 shadow-inner focus-ring-purple transition duration-200 appearance-none">
                                <option>Easy</option>
                                <option>Medium</option>
                                <option>Hard</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Generate Button --><div class="mt-auto pt-6">
                    <button id="generateBtn" class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white font-extrabold py-3 px-6 rounded-xl shadow-xl hover:shadow-2xl hover:from-indigo-600 hover:to-purple-700 transition duration-300 ease-in-out text-lg flex items-center justify-center transform hover:-translate-y-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M12 21v-1" />
                        </svg>
                        Craft My Recipe!
                    </button>
                </div>
            </aside>

            <!-- Right Content Area: Results --><!-- New: Glassmorphism effect: bg-white/30, backdrop-blur-xl, border, shadow-lg --><main class="w-full md:w-2/3 lg:w-3/4 h-full bg-white/30 backdrop-blur-xl border border-white/20 rounded-2xl shadow-lg p-6 md:p-8 overflow-hidden">
                <h2 class="text-3xl font-bold text-gray-800 mb-6">Results Area</h2>
                <div id="resultsContainer" class="h-full overflow-y-auto pb-16">
                    <!-- Loading State --><div id="loadingState" class="hidden h-full flex flex-col items-center justify-center text-purple-700">
                        <div class="spinner"></div>
                        <p class="mt-4 text-xl font-semibold animate-pulse">Whipping up something delicious...</p>
                    </div>
                    
                    <!-- Error State --><!-- New: Glassmorphism error panel --><div id="errorState" class="hidden h-full flex flex-col items-center justify-center">
                        <div class="p-8 bg-red-100/80 backdrop-blur-sm border-2 border-red-300 text-red-800 rounded-xl max-w-md text-center shadow-lg">
                            <svg class="w-16 h-16 text-red-600 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                            </svg>
                            <strong class="text-2xl font-bold">Uh oh! Chef's in trouble!</strong>
                            <p id="errorMessage" class="mt-2 text-lg"></p>
                            <p class="mt-4 text-gray-700">Please adjust your selections and try again.</p>
                        </div>
                    </div>

                    <!-- Recipe Display --><!-- New: Removed shadow-inner and bg-white for transparent look on glass panel --><div id="recipeDisplay" class="hidden bg-transparent p-0 md:p-2 rounded-lg prose max-w-none transition-opacity duration-300 opacity-0">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 not-prose">
                            <!-- New: Darker text for contrast --><h2 id="recipeName" class="text-4xl font-extrabold text-indigo-900 m-0 mb-4 sm:mb-0"></h2>
                            <button id="downloadBtn" class="ml-0 sm:ml-4 flex-shrink-0 bg-gradient-to-r from-green-500 to-teal-600 text-white font-bold py-2 px-5 rounded-lg shadow-lg hover:shadow-xl hover:from-green-600 hover:to-teal-700 transition duration-300 ease-in-out text-base flex items-center transform hover:-translate-y-0.5">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 10.5v6m0 0l3-3m-3 3l-3-3m-4 3h10a2 2 0 002-2V6a2 2 0 00-2-2H7a2 2 0 00-2 2v7.5a2 2 0 002 2z" />
                                </svg>
                                Download Recipe
                            </button>
                        </div>
                        <!-- New: Darker text for contrast --><p id="recipeDescription" class="text-gray-800 text-xl leading-relaxed mb-6"></p>
                        
                        <!-- New: Darker text for contrast --><h3 class="font-bold text-2xl text-indigo-800 border-b-2 border-purple-300 pb-2 mb-4">Ingredients</h3>
                        <ul id="recipeIngredients" class="list-disc pl-8 text-lg text-gray-800 leading-loose marker:text-purple-600">
                            <!-- Ingredients will be populated here --></ul>
                        
                        <!-- New: Darker text for contrast --><h3 class="font-bold text-2xl text-indigo-800 border-b-2 border-purple-300 pb-2 mb-4 mt-8">Instructions</h3>
                        <ol id="recipeInstructions" class="list-decimal pl-8 text-lg text-gray-800 leading-loose marker:text-purple-600">
                            <!-- Instructions will be populated here --></ol>
                    </div>

                    <!-- Initial State --><div id="initialState" class="h-full flex flex-col items-center justify-center text-center text-gray-700">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">Initial State</h3>
                        <svg class="h-28 w-28 mx-auto text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
                        </svg>
                        <p class="mt-6 text-2xl font-semibold text-indigo-700">Ready to cook up some magic?</p>
                        <p class="mt-2 text-lg text-gray-700 max-w-md">Use the controls on the left to tell our AI chef what you're craving!</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script type="module">
        // --- DOM Elements ---
        const mealTypeEl = document.getElementById('mealType');
        const ingredientsEl = document.getElementById('ingredients');
        const dietEl = document.getElementById('diet');
        const complexityEl = document.getElementById('complexity');
        const generateBtn = document.getElementById('generateBtn');
        const downloadBtn = document.getElementById('downloadBtn');

        // --- State Elements ---
        const resultsContainer = document.getElementById('resultsContainer');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const errorMessage = document.getElementById('errorMessage');
        const initialState = document.getElementById('initialState');
        
        // --- Recipe Display Elements ---
        const recipeDisplay = document.getElementById('recipeDisplay');
        const recipeName = document.getElementById('recipeName');
        const recipeDescription = document.getElementById("recipeDescription");
        const recipeIngredients = document.getElementById('recipeIngredients');
        const recipeInstructions = document.getElementById('recipeInstructions');

        // Store the raw text for download
        let recipeForDownload = "";

        // --- Gemini API Configuration ---
        // IMPORTANT: Leave apiKey as ""
        // The platform will automatically provide the necessary credentials.
        const apiKey = "AIzaSyBAgQ-3-EMWEZzNkkcXK_nb3YFamSvrvdc"; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

        // --- Event Listeners ---
        generateBtn.addEventListener('click', handleGenerateClick);
        downloadBtn.addEventListener('click', handleDownloadClick);

        /**
         * Main function to handle the "Generate" button click.
         */
        async function handleGenerateClick() {
            // 1. Get user inputs
            const mealType = mealTypeEl.value;
            const ingredients = ingredientsEl.value || "any";
            const diet = dietEl.value;
            const complexity = complexityEl.value;

            // 2. Set UI to loading state
            setLoadingState(true);

            try {
                // 3. Construct the prompt for the AI
                const prompt = `You are a world-class chef. Generate a unique and delicious recipe based on the following criteria:
                - Meal Type: ${mealType}
                - Key Ingredients: ${ingredients}
                - Dietary Restrictions: ${diet}
                - Complexity: ${complexity}
                
                Please provide a creative name for the recipe, a brief enticing description (1-2 sentences), a list of ingredients with quantities, and step-by-step instructions. Present the output ONLY as a JSON object matching the following schema.`;

                // 4. Define the desired JSON output structure
                const schema = {
                    type: "OBJECT",
                    properties: {
                        recipeName: { type: "STRING" },
                        description: { type: "STRING" },
                        ingredients: {
                            type: "ARRAY",
                            items: { type: "STRING" }
                        },
                        instructions: {
                            type: "ARRAY",
                            items: { type: "STRING" }
                        }
                    },
                    required: ["recipeName", "description", "ingredients", "instructions"]
                };

                // 5. Call the Gemini API
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: schema
                    }
                };

                const responseData = await callGeminiApi(payload);
                
                // 6. Display the recipe
                displayRecipe(responseData);

            } catch (error) {
                console.error("Error generating recipe:", error);
                showError(error.message || "Failed to generate recipe. Please try again.");
            } finally {
                // 7. Reset UI from loading state
                setLoadingState(false);
            }
        }

        /**
         * Calls the Gemini API with retry logic.
         * @param {object} payload - The payload to send to the API.
         * @param {number} retries - The number of retries left.
         * @param {number} delay - The delay in ms before retrying.
         * @returns {Promise<object>} - The parsed JSON response from the API.
         */
        async function callGeminiApi(payload, retries = 3, delay = 1000) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    console.error("API Error Body:", errorBody);
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const jsonText = result.candidates[0].content.parts[0].text;
                    try {
                        return JSON.parse(jsonText);
                    } catch (parseError) {
                        console.error("JSON Parse Error:", parseError, "Raw text:", jsonText);
                        throw new Error("The AI returned an invalid recipe format. Please try again.");
                    }
                } else {
                    console.warn("API response structure unexpected:", result);
                    if (result.promptFeedback && result.promptFeedback.blockReason) {
                        throw new Error(`Request blocked by safety settings: ${result.promptFeedback.blockReason}`);
                    }
                    throw new Error("Received an invalid response from the AI. Please try refining your inputs.");
                }
            } catch (error) {
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    // Exponential backoff
                    return callGeminiApi(payload, retries - 1, delay * 2);
                } else {
                    throw error;
                }
            }
        }

        /**
         * Renders the recipe data onto the page.
         * @param {object} recipe - The recipe object from the API.
         */
        function displayRecipe(recipe) {
            // Clear previous results and hide error
            recipeIngredients.innerHTML = '';
            recipeInstructions.innerHTML = '';
            errorState.classList.add('hidden');
            
            // Populate new data
            recipeName.textContent = recipe.recipeName;
            recipeDescription.textContent = recipe.description;

            recipe.ingredients.forEach(ingredient => {
                const li = document.createElement('li');
                li.textContent = ingredient;
                recipeIngredients.appendChild(li);
            });

            recipe.instructions.forEach(instruction => {
                const li = document.createElement('li');
                li.textContent = instruction;
                recipeInstructions.appendChild(li);
            });

            // Prepare text for download
            prepareDownloadText(recipe);

            // Show the recipe display with a fade-in effect
            recipeDisplay.classList.remove('hidden', 'opacity-0');
            recipeDisplay.classList.add('opacity-100');
        }

        /**
         * Handles the "Download" button click.
         */
        function handleDownloadClick() {
            if (!recipeForDownload) return;

            const recipeTitle = recipeName.textContent || "recipe";
            const filename = `${recipeTitle.toLowerCase().replace(/\s+/g, '_')}.txt`;

            const blob = new Blob([recipeForDownload], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        /**
         * Formats the recipe object into a plain text string.
         * @param {object} recipe - The recipe object.
         */
        function prepareDownloadText(recipe) {
            let text = `${recipe.recipeName.toUpperCase()}\n\n`;
            text += `${recipe.description}\n\n`;
            
            text += "--- INGREDIENTS ---\n";
            recipe.ingredients.forEach(ing => {
                text += `- ${ing}\n`;
            });
            
            text += "\n--- INSTRUCTIONS ---\n";
            recipe.instructions.forEach((inst, index) => {
                text += `${index + 1}. ${inst}\n`;
            });

            recipeForDownload = text;
        }

        /**
         * Shows or hides the loading state.
         * @param {boolean} isLoading - Whether to show the loading state.
         */
        function setLoadingState(isLoading) {
            if (isLoading) {
                initialState.classList.add('hidden');
                recipeDisplay.classList.add('hidden', 'opacity-0'); // Hide and reset opacity for fade-in
                errorState.classList.add('hidden');
                loadingState.classList.remove('hidden');
                generateBtn.disabled = true;
                generateBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                loadingState.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        /**
         * Displays an error message.
         * @param {string} message - The error message to display.
         */
        function showError(message) {
            errorMessage.textContent = message;
            errorState.classList.remove('hidden');
            recipeDisplay.classList.add('hidden');
            initialState.classList.add('hidden');
        }

    </script>
</body>
</html>

